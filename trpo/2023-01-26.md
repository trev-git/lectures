# Лекция про оптимизацию ради 0,002 секунд

Важно правильно задать тип показателя степени в операции возведения в степень. Всегда когда это возможно следует использовать целые числа. если показатели степени - небольшое целое число, то операцию возведения в степень выполняют повторяющимся умножением, а если показатель степени - число с плавающей точкой, то для выполнения операций возведения в степень необходимо вызывать специальную функцию.

Функции извлечения квадратного корня реализуются обычно гораздо быстрее и точность при этом выше, чем при выполнении операции возведения в степень (sqrt(a)).

Умножение выполняется значительно быстрее возведения в степень, поэтому если показатель степени - небольшое целое число, то операцию возведения в степень надо заменить несколькими операциями умножения

## Смешанные типы данных

Смешанные типы данных получаются в результате использования чисел различного типа в арифметических и логических операциях. Если смешиваются числа разного типа, то при выполнении арифметических операций часто необходимы преобразования, поэтому лучше объявлять как можно больше переменных одинакового типа. Смешанная арифметика занимает больше времени и памяти, поэтому избегайте смешанных типов данных. Правильно выбирайте тип используемых констант, например, если переменная a вещественного типа, то a = 0 неэффективно, а=0.0 - эффективно. если преобразование необходимо - он занимает много времени при его выполнении внутри цикла. например:

цикл i -1000
  a(i)=0
конец
Эти операторы должны выполнять 1000 раз преобразование. ф вот а(i)=0.0 позволяет избежать преобразования.
Подобная ситуация возникает при использовании оператора /, где преобразование необходимо. y=1.0/x - преобразование не происходит.

Необходимо писать все константы того типа, который преобладает в выражении.

## Организация циклов

Значительная часть времени при использовании циклов тратится на инициирование и завершение цикла

Тщательной организацией вложенных циклов можно сэкономить время

```
цикл k - 20 повт.          // инициирование цикла 1 раз
  цикл i - 10 повт.        // инициирование цикла 20 раз
    цикл L - 5 повт.       // инициирование цикла 200 раз
      операторы тела цикла // операторы выполняются 1000 раз
    конец L                // завершение цикла 1000 раз
  конец i                  // завершение цикла 200 раз
конец k                    // завершение цикла 20 раз
```

Инициирование всех циклов выполняется здесь 1+20+200=221, а завершение циклов 1220 раз

Путём реорганизации циклов (которая не всегда возможна) можно сократить число инициирований и завершений циклов

```
цикл L - 5 повт.           // инициирование цикла 1 раз
  цикл i - 10 повт.        // инициирование цикла 5 раз
    цикл k - 20 повт.      // инициирование цикла 50 раз
      операторы тела цикла // операторы выполняются 1000 раз
    конец k                // завершение цикла 1000 раз
  конец i                  // завершение цикла 50 раз
конец L                    // завершение цикла 5 раз
```

В этом примере 56 инициирований и 1055 завершений цикла

Таким образом, число инициирований и завершений циклов может быть сокращено вложением циклов друг в друга таким образом, чтобы внешний цикл имел 

При попытке ускорить выполнение программы циклы являются самым важным фактором, так как операторы внутри цикла могут выполняться много тысяч раз и любая экономия, даже совсем небольшая, будучи увеличена в 1000 раз даёт существенный выигрыш.

```
цикл A - 100 повт.
  цикл B - 100 повт.
    цикл С - 100 повт.
      ...
    конец C
  конец B
конец A
```

Даже самая маленькая экономия будет увеличиваться 100\*100*100=1000000 раз. Коэффициент улучшения 1000000 раз.

Очень малое улучшение внутри цикла C гораздо выгоднее, чем значительное улучшение вне его. Затем рассмотрите цикл B.

Все предложения по оптимизации арифметических операций, повторяющихся вычислений и преобразования данных. Повторяющиеся вычисления в циклах являются наиболее типичными ошибками, влияющими на эффективность, например

Можно значительно сэкономить время выполнения программы просто проверкой циклов, выполняющих много повторений и уменьшением повторяющихся вычислений внутри этих циклов. Этот процесс называются исключением инвариантных выражений. Инвариантными являются выражения, которые не изменяются внутри цикла

```
dk = d/k
цикл i - 10 повт.
  di = d/i
  цикл j - 10 повт.
    a(i,j) = b(i,j) + di + dk
```

Теперь dk вычисляется 1 раз вместо 100

Иногда издержки по организации завершения цикла оказываются слишком дорогими
```
цикл i - 1000 повт.
  a(i) = 0.0

цикл i - 500 повт.
  a(i) = 0.0
  a(i+1) = 0.0
конец i
```

Сжатие сокращает накладные расходы цикла и требуемый размер памяти

Последний пример оптимизации цикла

Оператор if должен выполняться сто раз, хотя переменная T не изменяется внутри цикла. Более эффективный способ состоит в следующем

Оператор if выполняется только один раз. Этот процесс называется разъединением. Время выполнения здесь уменьшается за счёт расхода памяти.