# Специальные реляционные операции

Операция ограничения (выборка) требует наличия двух операндов: ограничиваемого отношения и условие ограничения.

Операция ограничения отношения R WHERE f представляет собой новое отношение с таким же телом и заголовком, состоящим из таких кортежей R, которое удовлетворяет истинности логического выражения, заданного формулой f

R

| ФИО         | Группа | Пол |
|-------------|--------|-----|
|Иванов И.И.  |44      |М    |
|Петров В.П.  |44      |М    |
|Морозов В.М. |35      |М    |
|Агатова А.М. |44      |Ж    |
|Сидоров В.А. |35      |М    |
|Смирнов А.А. |35      |М    |
|Сорокина В.Н.|44      |Ж    |
|Михайлов М.В.|35      |М    |

R WHERE 'группа'=44

| ФИО         | Группа | Пол |
|-------------|--------|-----|
|Иванов И.И.  |44      |М    |
|Петров В.П.  |44      |М    |
|Агатова А.М. |44      |Ж    |
|Сорокина В.Н.|44      |Ж    |

# Операция проекции

Результатом проекции отношения A на множество атрибутов { a1, a2, ..., an } является отношением заголовком определяемым множеством атрибутов {a1, a2, ..., an} и телом, состоящим из кортежей вида \<a1:v1, a2:v2, ...\>, таких, что отношение A имеется кортеж атрибут a1, который имеет значение v1, a2 - v2 и т.д. Т.е. выделяется вертикальная выборка с удалением кортежей дубликатов.

R PROJECT Студенты {Группа}

| Группа |
|--------|
|44      |
|35      |

Операция проекции допускает следующие дополнительные варианты записи:
- отсутствие списка атрибутов подразумевает указание всех атрибутов (операция тождественной проекции)
- результатом пустой проекции является пустое множество
- операция "проекция" может применяться к произвольному отношению, в том числе к результату выбора

# Операция деления

Делением отношений A DIVIDE BY B называется отношением с заголовком a и телом, содержащим множество всех кортежей a, таких, что существует кортеж ab, которое принадлежит отношению A для всех кортежей a, принадлежащих кортежу b.

Отношение A

|ФИО|Предмет|Оценка|
|---|-------|------|
|Иванов И.И.|матем|4|
|Петров В.М.|матем|3|
|Агатова А.В.|матем|5|
|Сидоров А.А.|матем|3|
|Иванов И.И.|физика|4|
|Комков М.М.|физика|4|
|Агатова А.В.|физика|5|
|Соков М.В.|физика|4|
|Петров В.М.|химия|4|
|Попов П.П.|химия|3|
|Комков М.М.|химия|4|
|Агатова А.В.|химия|4|
|Котов И.И.|химия|3|

Отношение B

|Предмет|
|-------|
|матем  |
|физика |
|химия  |

A DIVIDE BY B
|ФИО         |
|------------|
|Агатова А.В.|

# Операция соединения

Соединение Cf(R1,R2) отношений R1 и R2, по условию, заданной формулой f представляет собой отношение R', которое можно получить путём декартового произведения отношений R1 и R2 с последующим применением к результату операции выборки по формуле f.

Частными случаями соединения являются эквисоединения и естественные соединения. Операция эквисоединения определяется тем, что формула задаёт равенство операндов.

Операция естественного соединения (JOIN) применяется к двум отношениям, имеющим общий атрибут

(R1 TIMES R2) WHERE R1.Группа = R2.Группа

R1

|ФИО|Группа|Пол|Куратор|Группа|
|---|------|---|-------|------|
|   | 44   |   |       | 44   |
|   | 35   |   |       | 35   |

# Связывание таблиц, понятие ссылочной целостности

Обычно реляционная БД состоит из набора взаимосвязанных таблиц. Организация связи между двумя или несколькими таблицами называется связыванием таблиц.

Для связывания таблиц используют поля связи, т.е. совпадащие поля. 

!!! Поля связи должны быть одного типа данных !!! 

Подчинённые таблицы для связи с главной таблицей задаётся индекс, который является внешним ключём.

Выделяют три вида связи:
- один ко многим (одна запись таблицы ко многим записям второй таблицы)
- один к одному (одна запись таблицы к одной записи второй таблицы)
- многие ко многим 

Всякую связь многие ко многим в реляционной базе данных необходимо заменить на связь один ко многим с помощью введения дополнительных таблиц.

Ссылочная целостность - согласованность между связанными таблицами.

Внешний ключ - поле в зависимой таблице, которое может содержать значение первичного ключа из искомой таблицы.

Работа со связанными таблицами имеет следующие особенности:
- при изменении поля связи главной таблицы нужно соответственно изменять поле связи в зависимой таблице (каскадные изменения)
- при удалении записи из главной таблицы нужно удалять записи и из зависимой таблицы.
- При добавлении записи в подчинённую таблицу значение её поля связи должно быть установлено равным значением поля связи главной таблицы.

