# Битовые команды

## Логические команды

| x  | not x |
| -- | ----- |
|  0 |  1    |


| x  | y  | x and y | x or y | x xor y |
| -- | -- | ------- | ------ | ------- |
|  0 |  1 |    0    |   0    |    0    |
|  0 |  1 |    0    |   1    |    1    |
|  1 |  0 |    0    |   1    |    1    |
|  1 |  1 |    1    |   1    |    0    |

Логические команды реализуют поразрядные операции (i-тый разряд зависит только от i-тых разрядов операнда)

В этих командах бит 1 трактуется как истина, а 0 - как ложь.

Логические команды меняют все флаги условий, но интерес представляет флаг ZF(другие флаги предназначены для работы с числами и в логических командах мало информативные).

Операнды логических команд должны быть одного типа.

### 1. Отрицание

```x86asm
NOT <оп>
```

- меняет каждый бит на противоположный (0 -> 1, 1 -> 0)
- рез-т записывается на место операнда (регистр / адресное выражение)

```x86asm
MOV AL, 1100b
NOT AL          ; 1111 0011
```

### 2. Конъюнкция

```x86asm
AND <оп1>, <оп2>
```

- производит поразрядное логическое умножение битов каждого операнда
- рез-т записывается на место 1-го операнда 


| оп1       | оп2                        | 
| --------  | -------------------------- |
|  регистр  |  константа, регистр, адрес |
|  адрес    |  константа, регистр        |


```x86asm
MOV AL, 1100b
AND AL, 1010B   ; AL = 0000 1000
```

### 3. Проверка

```x86asm
TEST <оп1>, <оп2>
```

- эквивалентна AND, но рез-т логическое умножения никуда не записывается.
- цель - установка флагов
- самый интересный флаг - ZF

MOV BH, 1100b
TEST BH, 0011b ; BH = 1100, ZF = 1
TEST BH, 1010b ; BH = 1100, ZF = 0

Команда TEST применяется для проверки, являются ли нулевыми какие-либо разряды операнда.

```x86asm
TEST AX, 111b
JZ L ; если три правые бита нулевые, перейти на метку L
```

### 4. Дизъюнкция (логическое сложение)

```x86asm
OR оп1, оп2
```

Команда производит поразрядное логическое сложение операндов и записывает результат на место первого операнда.

Допустимые комбинации операндов - как в команде AND.

```x86asm
MOV CL, 1100b
OR  CL, 1010b
; CL = 00001110b
```

### 5. Исключающее ИЛИ (XOR)

```x86asm
XOR оп1, оп2
; X - exclusive
```

Команда производит поразрядное исключающее ИЛИ (или то или другое, но не то и не другое одновременно, то есть исключается случай, когда оба операнда истинны) и записывает результат на место первого операнда.

Допустимые типы операндов - как у команды `AND`.

```x86asm
MOV CL, 1100b
XOR CL, 1010b
;CL = 00000110b
```

Если операнды одинаковые, результат `XOR` будет нулевым.

## Команды сдвига

Команды сдвига имеют два операнда:

- набор битов, которые будут сдвигаться;
- целое без знака определяет на сколько разрядов надо сдвинуть первый операнд.

Результат сдвига записывается на место первого операнда.

Разновидности команд сдвига:

1. мнемокод оп1
2. мнемокод оп, CL

При CL=0 сдвига нет, при CL>0, повторение CL раз первого варианта

Операнд оп может быть регистром или адресным выражением.

Команды сдвига меняют все флаги, но интерес представляет флаг переноса CF.

### Логические сдвиги

```x86asm
SHL оп, 1
SHR оп, 1
```

В сдвиге участвуют все биты первого операнда. Бит, уходящий за пределы ячейки, заносится во флаг CF, а с другого конца в операнд добавляется 0.

```x86asm
MOV AL, 0100 0111b
SHL AL, 1 ; AL = 10001110b, CF = 0
MOV AL, 0100 0111b
SHR AL, 1 ; AL = 00100011b, CF = 1
MOV DH, 0011 1000b
SHL DH, 3 ; DH = 1100 0000b, CF = 1
```

Величины размером в слово хранятся в перевёрнутом виде. Это учитывается командами сдвига:

Слово сдвигается так, если бы оно было записано в неперевёрнутом виде.

```x86asm
X DW 001Fh

SHL X, 1
```
